(this.webpackJsonpmy_ts_layoutpage=this.webpackJsonpmy_ts_layoutpage||[]).push([[0],{32:function(t,e,a){t.exports=a(71)},37:function(t,e,a){},38:function(t,e,a){},49:function(t,e,a){},50:function(t,e,a){},51:function(t,e,a){},70:function(t,e,a){},71:function(t,e,a){"use strict";a.r(e);var n=a(0),i=a.n(n),o=a(10),r=a.n(o),c=(a(37),a(38),a(3)),s=a(4),l=a(6),u=a(5),d=a(7),p=a(11),y=a.n(p),h=a(73),m=(a(49),function(t){function e(){var t,a;Object(c.a)(this,e);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(a=Object(l.a)(this,(t=Object(u.a)(e)).call.apply(t,[this].concat(i)))).state={comlist:[{value:"\u5bb9\u5668",type:"container",icon:"iconziyuan11"},{value:"test",type:"test",icon:"iconziyuan11"},{value:"test2",type:"test2",icon:"iconziyuan11"}]},a.height=document.body.clientHeight,a}return Object(d.a)(e,t),Object(s.a)(e,[{key:"render",value:function(){var t=this;return i.a.createElement("div",{className:"nl"},i.a.createElement("div",{className:"nl-title"},"\u7ec4\u4ef6\u680f"),i.a.createElement("ul",{className:"nl-content"},this.state.comlist.map((function(e,a){return i.a.createElement("li",{className:"nl-li",key:a,onClick:function(){t.props.onClick(e)}},e.value)}))))}}]),e}(n.Component)),f=a(2),v=a(8),b=(a(50),function t(e,a,n){return e.map((function(e){if(e.id===a)return Object(v.a)({},e,{editorData:n});if(e.id!==a&&e.layout){var i=t(e.layout,a,n);return Object(v.a)({},e,{layout:i})}return e}))}),g=function t(e,a,n){return e.map((function(e){if(e.id===a)return n?Object(v.a)({},e,{static:!0}):Object(v.a)({},e,{static:!1});if(e.id!==a&&e.layout){var i=t(e.layout,a,n);return Object(v.a)({},e,{layout:i})}return e}))},E=function t(e,a,n){return e.forEach((function(e){e.id===a&&(n=e.type),e.id!==a&&e.layout&&(n=t(e.layout,a,n))})),n},C=function(t){var e;return t.forEach((function(t){"container"===t.type&&((t.editorData||{}).switch&&(e=t.id))})),e},k=function t(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new WeakMap;if("object"===typeof e){var n=Array.isArray(e),i=n?[]:{};if(a.get(e))return a.get(e);a.set(e,i);var o=n?void 0:Object.keys(e);return(o||e).forEach((function(n,r){o&&(r=n),i[r]=t(e[r],a)})),i}return e},O=function(t,e,a){var n=document.body.clientWidth,i=document.createElement("div");i.setAttribute("class","tipsClass"),i.innerHTML=t;var o=document.querySelector("body");o.appendChild(i);var r=document.querySelector("div.tipsClass");r.style.top=e+"px",r.style.left=n/2-175+"px",r.style.position="absolute",r.style.padding="10px 16px",r.style.background="#fff",r.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)",r.style.margin="0 auto",r.style.fontSize="12px",r.style.height="auto",r.style.color="rgba(0, 0, 0, 0.65)",r.style.borderRadius="5px",r.style.textAlign="center",r.style.pointerEvents="all",r.setAttribute("class","component-message-wrap-fadein"),r.style.display="inline-block",setTimeout((function(){r.setAttribute("class","component-message-wrap-fadeout"),setTimeout((function(){o.removeChild(r)}),2e3)}),1e3*a)},x=function(t){function e(){var t,a;Object(c.a)(this,e);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(l.a)(this,(t=Object(u.a)(e)).call.apply(t,[this].concat(o)))).state={containerId:0},a.itemEditor=function(t,e){var n,o=a.props.containerId;return"string"===typeof t?i.a.createElement("div",{key:e,className:"editor_box text"},t):"input"===t.type?i.a.createElement("div",{key:e,className:"editor_box input_box"},i.a.createElement("label",null,t.text),i.a.createElement("input",{className:"edit_input",onChange:function(e){var n=e.target.value,i=k(a.state[o]);i=Object(v.a)({},i,Object(f.a)({},t.field,n)),a.setState(Object(f.a)({},o,i)),a.props.saveEditorData(i)},value:a.state[o][t.field]||"",placeholder:t.text})):"show_name"===t.type?i.a.createElement("div",{key:e,className:"editor_box"},i.a.createElement("label",null,"\u7ec4\u4ef6\u540d\uff1a"),i.a.createElement("span",null,t.text)):"select"===t.type?i.a.createElement("div",{key:e,className:"editor_box  input_box"},i.a.createElement("label",null,t.text),i.a.createElement("select",{className:"edit_input",value:a.state[o][t.field]||void 0,placeholder:t.text,onChange:function(e){var n=e.target.value,i=k(a.state[o]);i=Object(v.a)({},i,Object(f.a)({},t.field,n)),a.setState(Object(f.a)({},o,i)),a.props.saveEditorData(i)}},t.data.map((function(t){return i.a.createElement("option",{key:t.key,value:t.key},t.value)})))):"selectIcon"===t.type?i.a.createElement("div",{key:e,className:"editor_box  input_box"},i.a.createElement("label",null,t.text),i.a.createElement("select",{className:"edit_input",value:a.state[o][t.field]||void 0,placeholder:t.text,onChange:function(e){var n=e.target.value,i=k(a.state[o]);i=Object(v.a)({},i,Object(f.a)({},t.field,n)),a.setState(Object(f.a)({},o,i)),a.props.saveEditorData(i)}},t.data.map((function(t){var e="res/icon/".concat(t.key,".png");return i.a.createElement("option",{key:t.key,value:t.key},i.a.createElement("div",{style:{display:"flex",alignItems:"center"}},i.a.createElement("img",{style:{width:"20px",height:"20px",marginRight:"2px"},src:e,alt:""}),t.value))})))):"switch"===t.type?(n=!!a.state[o]&&!!a.state[o][t.field],i.a.createElement("div",{key:e,className:"editor_box"},i.a.createElement("span",{style:{fontSize:"16px",color:"#999"}},t.text,"\uff1a"),i.a.createElement("input",{type:"checkbox",checked:n,onChange:function(e){var n=a.props.isContainerState,i=e.target.checked;if(!0===n&&!0===i)return O("\u8bf7\u786e\u4fdd\u4e4b\u524d\u5bb9\u5668\u72b6\u6001\u5df2\u5173\u95ed",200,2),void a.props.setOpenContainerId();var r=k(a.state[o]);a.setState(Object(f.a)({},o,Object(v.a)({},r,Object(f.a)({},t.field,i))),(function(){a.props.storeData(i,a.state[o])}))}}))):i.a.createElement("div",{key:e,className:"editor_box"})},a}return Object(d.a)(e,t),Object(s.a)(e,[{key:"render",value:function(){var t=this;return i.a.createElement("div",null,i.a.createElement("div",{className:"editor_wrapper"},i.a.createElement("div",{className:"editor_name"},"\u7f16\u8f91\u680f")),i.a.createElement("div",{className:"editor_content"},i.a.createElement("div",{className:"editor_box "},i.a.createElement("button",{className:"edit_btn hvr-buzz-out",title:"\u8bf7\u5148\u9009\u4e2d\u9700\u8981\u5220\u9664\u7684\u7ec4\u4ef6",onClick:this.props.deleteItem},"\u5220\u9664\u7ec4\u4ef6")),this.props.configData.map((function(e,a){return t.itemEditor(e,a)}))))}}],[{key:"getDerivedStateFromProps",value:function(t,e){var a;return e.containerId!==t.containerId?(a={},Object(f.a)(a,t.containerId,t.value),Object(f.a)(a,"containerId",t.containerId),a):null}}]),e}(n.Component),j=(a(21),a(22),a(51),a(13)),S=a.n(j),w=i.a.createContext({}),N=(a(70),Object(p.WidthProvider)(y.a)),_=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(l.a)(this,Object(u.a)(e).call(this,t))).click=function(){var t=a.props.data||{},e=t.click_type;"dialog"!==e?"map"===e&&a.props.clickCesium(t.chartfn):a.props.changeDialogVisible("90%","90%")},a.height=document.body.clientHeight,a}return Object(d.a)(e,t),Object(s.a)(e,[{key:"render",value:function(){var t=this,e=this.props.data&&(this.props.data.bdcolor||"rgba(0,0,0,.3)");return i.a.createElement("div",{className:"container_wrapper",style:{border:"1px solid "+e,background:this.props.data&&(this.props.data.bacc||"transparent")}},this.props.data&&this.props.data.title?i.a.createElement("div",{className:"container_title",onClick:this.click},this.props.data.title):null,i.a.createElement(N,{className:"layout",compactType:null,preventCollision:!0,onLayoutChange:function(e){t.props.onLayoutChange(e)},rowHeight:this.height/62.46,cols:24},this.props.children))}}]),e}(n.Component);_.editorConfig=[{text:"\u5bb9\u5668",type:"show_name"},{field:"switch",text:"\u662f\u5426\u5f00\u542f\u5bb9\u5668\u72b6\u6001",type:"switch"},{field:"title",text:"\u8f93\u5165\u6807\u9898",type:"input"},{field:"bacc",text:"\u5bb9\u5668\u80cc\u666f\u8272",type:"input"},{field:"bdcolor",text:"\u8fb9\u6846\u8272",type:"input"},"\u8bbe\u7f6e\u70b9\u51fb\u54cd\u5e94\u7c7b\u578b",{field:"click_type",text:"\u54cd\u5e94\u7c7b\u578b",type:"select",data:[{key:"map",value:"\u5730\u56fe\u4ea4\u4e92"},{key:"dialog",value:"\u5f39\u51fa\u6846"}]},{field:"dialog_type",text:"\u5f39\u6846\u6570\u636e\u63a5\u53e3",type:"select",data:[{key:"plant",value:"\u690d\u7269\u591a\u6837\u6027"},{key:"animal",value:"\u52a8\u7269\u591a\u6837\u6027"},{key:"msg",value:"\u4fe1\u606f"},{key:"education",value:"\u793e\u533a\u6559\u80b2"},{key:"pie",value:"\u997c\u56fe"}]},{field:"chartfn",text:"\u5730\u56fe\u4ea4\u4e92\u65b9\u6cd5",type:"selectChartFn"}];var I=_,D=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(l.a)(this,Object(u.a)(e).call(this,t))).testFn=function(){console.log("===@@@@@@@>test1"),a.setState({test:[{a:2}]})},a.state={test:[{a:2}]},a.filter={},a}return Object(d.a)(e,t),Object(s.a)(e,[{key:"componentDidMount",value:function(){this.setState({test:[{a:Math.random()}]})}},{key:"shouldComponentUpdate",value:function(t,e){return console.log("nextState===>",e),console.log("this.state===>",this.state),!1}},{key:"componentDidUpdate",value:function(t,e,a){console.log(":componentDidUpdate:");var n=this.context.data.filter;JSON.stringify(this.filter)!==JSON.stringify(n)&&(this.filter=n,this.testFn())}},{key:"render",value:function(){var t=this.context;return console.log("render1===>"),i.a.createElement("div",{style:{width:"100%",height:"100%",background:"#666"}},i.a.createElement("div",{onClick:function(){t.test(30)}},"\u6309\u94ae"),i.a.createElement("div",null,JSON.stringify(t.data)),this.state.test.map((function(t){return i.a.createElement("div",null,t.a)})))}}]),e}(n.Component);D.editorConfig=[{text:"test",type:"show_name"}],D.contextType=w;var L=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(l.a)(this,Object(u.a)(e).call(this,t))).state={test:[{a:1}]},a.filter={},a}return Object(d.a)(e,t),Object(s.a)(e,[{key:"render",value:function(){return console.log("render2===>"),i.a.createElement("div",{style:{width:"100%",height:"100%",background:"red",color:"#fff"}},"\u8fd9\u662f\u7ec4\u4ef6test2")}}]),e}(n.Component);L.editorConfig=[{text:"test",type:"show_name"}];var T=Object(p.WidthProvider)(y.a),V={container:I,test:D,test2:L},A=15,P=15,z=function(t){function e(){var t,a;Object(c.a)(this,e);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(l.a)(this,(t=Object(u.a)(e)).call.apply(t,[this].concat(o)))).editor=[],a.id=1,a.height=document.body.clientHeight,a.state={containerId:0,isContainer:!1,openContainerId:-1,containerType:"",layout:[],editorVisible:!0,navVisible:!0,filter:{}},a.needEditInit=function(){S()({url:"ly/style/getStyle.ht",method:"POST",baseURL:"http://47.108.28.1:8085/",timeout:3e4,data:{id:"test2"}}).then((function(t){var e=t.data.data.style;(e=JSON.parse(e))&&(a.id=e.id,a.setState({layout:e.layout,isContainer:e.isContainer}))})).catch((function(){a.setState({})}))},a.displayInit=function(){S()({url:"ly/style/getStyle.ht",method:"POST",baseURL:"http://47.108.28.1:8085/",timeout:3e4,data:{id:"test2"}}).then((function(t){var e=t.data.style;(e=JSON.parse(e))&&a.setState({layout:e.layout})}))},a.onLayoutChange=function(t){var e=k(a.state.layout);t.forEach((function(t){e.forEach((function(e){t.i===String(e.id)&&(e.x=t.x,e.y=t.y,e.w=t.w,e.h=t.h),e.layout&&e.layout.length>0&&e.layout.forEach((function(e){t.i===String(e.id)&&(e.x=t.x,e.y=t.y,e.w=t.w,e.h=t.h)}))}))})),a.setState({layout:e})},a.setData=function(t){a.setState({containerId:t.id,containerType:t.type})},a.componentClick=function(t,e,n){t.stopPropagation(),a.state.containerId!==n.id&&(a.editor=e.editorConfig,a.setData(n))},a.getComponent=function(t,e){var n=t.type;if(V.hasOwnProperty(n)){var o=V[n];return"container"===n?i.a.createElement("div",{"data-grid":t,key:t.id,onClick:function(e){return a.componentClick(e,o,t)},className:"component_wrapper ".concat(a.state.openContainerId===t.id?"blink-1":"")},i.a.createElement(o,{data:t.editorData,onLayoutChange:a.onLayoutChange},t.layout.map((function(t,e){return a.getComponent(t,e)})))):i.a.createElement("div",{key:t.id,onClick:function(e){return a.componentClick(e,o,t)},"data-grid":t,className:"component_wrapper"},i.a.createElement(o,{data:t.editorData}))}return null},a.changeLayout=function(t){var e=k(a.state.layout),n=a.state.containerId,i=a.state.isContainer,o=E(e,n,"");if(i){if("container"===t.type&&"container"===o)return a.setOpenContainerId(),void O("\u4e0d\u80fd\u5d4c\u5957\u6dfb\u52a0\u5bb9\u5668",200,2);if("container"===t.type&&"container"!==o&&""!==o)return void O("\u8bf7\u5148\u9009\u4e2d\u72b6\u6001\u4e3a\u5f00\u542f\u7684\u5bb9\u56681",200,2);if("container"===t.type&&""===o)return e.push({i:String(a.id),id:a.id,x:A,y:P,w:1,h:1,type:t.type,static:!1,value:t.value,layout:[],editorData:{}}),a.id++,void a.setState({layout:e});var r=!1;if(e.forEach((function(e){e.id===n&&!0===e.static&&(r=!0,e.layout.push({i:String(a.id),id:a.id,x:0,y:2*e.layout.length,w:1,h:1,type:t.type,static:!1,value:t.value,layout:[],editorData:{}}))})),!r)return a.setOpenContainerId(),void O("\u8bf7\u5148\u9009\u4e2d\u72b6\u6001\u4e3a\u5f00\u542f\u7684\u5bb9\u56682",200,2)}else e.push({i:String(a.id),id:a.id,x:A,y:P,w:1,h:1,type:t.type,static:!1,value:t.value,layout:[],editorData:{}});a.id++,a.setState({layout:e})},a.saveData=function(t){var e=a.state.layout;t&&e.forEach((function(t){t.static=!0,t.layout&&t.layout.length>0&&t.layout.forEach((function(t){t.static=!0}))}));var n={layout:e,id:a.id,isContainer:a.state.isContainer};S()({url:"ly/style/saveStyle.ht",method:"POST",baseURL:"http://47.108.28.1:8085/",timeout:6e3,data:{id:"test2",style:n}}).then((function(t){"0"===t.data.code&&O("\u4fdd\u5b58\u6210\u529f",200,2)}))},a.deleteItem=function(){var t=a.state,e=t.containerId,n=t.isContainer,i=k(a.state.layout);0!==e&&(i.forEach((function(t,o){if(t.id===e)return!0===t.static&&n&&a.setState({isContainer:!1}),void i.splice(o,1);t.layout&&t.layout.length>0&&t.layout.forEach((function(a,n){a.id!==e||t.layout.splice(n,1)}))})),a.editor=[],a.setState({layout:i}))},a.editorValue=function(){var t=a.state.containerId,e=k(a.state.layout),n={};return e.forEach((function(e){e.id===t&&(n=e.editorData),e.id!==t&&e.layout&&e.layout.forEach((function(e){e.id===t&&(n=e.editorData)}))})),n},a.setOpenContainerId=function(){var t=C(a.state.layout)||-1;t&&"number"===typeof t&&a.setState({openContainerId:t})},a.saveEditorData=function(t){var e=a.state.containerId,n=a.state.layout,i=b(n,e,t);a.setState({layout:i})},a.isContainer=function(t,e){var n=a.state.containerId;if(null!=n){var i=k(a.state.layout),o=g(i,n,t);a.setState({isContainer:t,layout:o},(function(){var t=b(o,n,e);a.setState({layout:t})}))}},a.storeData=function(t,e){a.state.isContainer&&t?O("\u8bf7\u786e\u4fdd\u4e4b\u524d\u5bb9\u5668\u72b6\u6001\u5df2\u5173\u95ed",200,2):a.isContainer(t,e)},a.isShowNav=function(){a.setState({navVisible:!a.state.navVisible})},a.isShowEditor=function(){a.setState({editorVisible:!a.state.editorVisible})},a.test=function(t){a.setState({filter:t})},a}return Object(d.a)(e,t),Object(s.a)(e,[{key:"componentDidUpdate",value:function(){this.state.openContainerId===this.state.containerId&&this.setState({openContainerId:-1})}},{key:"componentDidMount",value:function(){this.height=document.body.clientHeight,this.props.isDisplay?this.displayInit():this.needEditInit()}},{key:"render",value:function(){var t=this;return i.a.createElement(w.Provider,{value:{data:{filter:this.state.filter},test:this.test}},i.a.createElement("div",{className:"wrapper_container"},i.a.createElement("div",{className:"tool"},i.a.createElement("span",{className:"tool_btn",onClick:this.isShowNav},"\u5bfc\u822a"),i.a.createElement("span",{className:"tool_btn",onClick:this.isShowEditor},"\u7f16\u8f91\u680f"),i.a.createElement("span",{className:"tool_btn",onClick:function(){return t.saveData(!0)}},"\u4fdd\u5b58"),i.a.createElement("span",{className:"tool_btn",onClick:function(){return t.saveData(!1)}},"\u5b58\u8349\u7a3f")),i.a.createElement(h.a,{in:this.state.navVisible,timeout:1e3,classNames:"nav_visible",unmountOnExit:!0,appear:!0},i.a.createElement("div",{className:"navLeft_container"},i.a.createElement(m,{onClick:this.changeLayout}))),i.a.createElement("div",{className:"main_container"},i.a.createElement("div",{className:""},i.a.createElement("div",{style:{position:"absolute",zIndex:0,width:"100%",height:"100%",background:"#ccc"}}),i.a.createElement(T,{margin:[0,0],onLayoutChange:function(e){t.onLayoutChange(e)},compactType:null,className:"layout1",preventCollision:!0,layout:this.state.layout,cols:96,rowHeight:this.height/62.46},this.state.layout.map((function(e,a){return t.getComponent(e,a)}))))),i.a.createElement(h.a,{in:this.state.editorVisible,timeout:1e3,classNames:"editor_visible",unmountOnExit:!0,appear:!0},i.a.createElement("div",{className:"editor_container"},i.a.createElement(x,{deleteItem:this.deleteItem,value:this.editorValue(),saveEditorData:this.saveEditorData,containerId:this.state.containerId,configData:this.editor,storeData:this.storeData,isContainerState:this.state.isContainer,isContainer:this.isContainer,setOpenContainerId:this.setOpenContainerId})))))}}]),e}(n.Component),H=function(){return i.a.createElement("div",{className:"App"},i.a.createElement(z,{isDisplay:!1}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement(H,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}},[[32,1,2]]]);
//# sourceMappingURL=main.772eb164.chunk.js.map